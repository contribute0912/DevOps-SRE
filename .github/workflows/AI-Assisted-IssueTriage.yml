
name: Simple AI Issue Triage (with Severity & Priority)

on:
  issues:
    types: [opened, edited, reopened]
  workflow_dispatch:

permissions:
  contents: read
  issues: write

env:
  MODEL_ID: "openai/gpt-4.1-mini"
  # Map model outputs -> your label names (edit to match your repo)
  PRIORITY_LABELS_JSON: |
    {
      "P0": "priority:P0",
      "P1": "priority:P1",
      "P2": "priority:P2",
      "P3": "priority:P3"
    }
  SEVERITY_LABELS_JSON: |
    {
      "critical": "severity:critical",
      "high": "severity:high",
      "medium": "severity:medium",
      "low": "severity:low"
    }

jobs:
  triage:
    runs-on: ubuntu-latest

    steps:
      - name: Install jq and GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y jq
          # gh is typically preinstalled on ubuntu-latest, but this ensures it's available
          gh --version || (type -p curl >/dev/null || sudo apt-get install -y curl && \
            curl -fsSL https://raw.githubusercontent.com/cli/cli/trunk/script/install.sh | sudo bash)

      - name: Build user prompt
        run: |
          cat > prompt.json <<'JSON'
          {
            "task": "Classify this issue with category, severity, and priority. Return strict JSON with keys: category, severity, priority, labels (array).",
            "valid_values": {
              "category": ["bug","feature","docs","question","chore","security","performance","other"],
              "severity": ["critical","high","medium","low", "null"],
              "priority": ["P0","P1","P2","P3", "null"]
            },
            "issue": {
              "title": "${{ github.event.issue.title }}",
